{% extends "base.html" %}
{% block title %}Manage User Access{% endblock %}

{% block body %}
<style>
    /* Dark Blue Header to match MMU branding */
    .admin-header { 
        background-color: #012d9e; 
        color: white; 
        padding: 25px; 
        margin-bottom: 20px; 
        border-radius: 0 0 8px 8px;
    }
    
    .container { width: 90%; margin: auto; }
    
    .user-table { 
        width: 100%; 
        border-collapse: collapse; 
        background: white; 
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    
    .user-table th { 
        background-color: #f8f9fa; 
        padding: 15px; 
        text-align: left; 
        border-bottom: 2px solid #012d9e; 
    }
    
    .user-table td { padding: 15px; border-bottom: 1px solid #eee; }

    /* Role Badges matching your colorful logic */
    .badge { padding: 5px 12px; border-radius: 20px; font-size: 0.85rem; font-weight: bold; }
    .badge-admin { background-color: #e8f5e9; color: #2e7d32; } /* Green for Admin */
    .badge-user { background-color: #e3f2fd; color: #1565c0; }  /* Blue for User */

    .update-btn { 
        background-color: #012d9e; 
        color: white; 
        border: none; 
        padding: 8px 15px; 
        border-radius: 4px; 
        cursor: pointer; 
    }
    
    .update-btn:hover { background-color: #012d9e; }
</style>

<div class="admin-header">
    <div class="container">
        <h1 style="margin: 0;">User Access Management</h1>
        <p style="margin: 5px 0;"><a href="{{ url_for('admin_dashboard') }}" style="color: #64b5f6; text-decoration: none;">‚Üê Return to Dashboard</a></p>
    </div>
</div>

<div class="container">
    {% with messages = get_flashed_messages() %}
      {% if messages %}
        {% for message in messages %}
          <div style="background: #e8f5e9; color: #2e7d32; padding: 15px; margin-bottom: 20px; border-radius: 4px;">
            {{ message }}
          </div>
        {% endfor %}
      {% endif %}
    {% endwith %}
    <div style="margin-bottom: 20px; background: #f8f9fa; padding: 15px; border-radius: 8px; border: 1px solid #ddd;">
        <form action="{{ url_for('manage_users') }}" method="GET" style="display: flex; gap: 10px;">
            <input type="text" name="search" placeholder="Search by User ID " 
                   value="{{ request.args.get('search', '') }}" 
                   style="flex-grow: 1; padding: 10px; border: 1px solid #ccc; border-radius: 4px;">
            
            <button type="submit" class="update-btn">Search</button>
            
            {% if request.args.get('search') %}
                <a href="{{ url_for('manage_users') }}" 
                   style="text-decoration: none; padding: 10px; color: #666; background: #eee; border-radius: 4px;">Clear</a>
            {% endif %}
        </form>
    </div>

    <table class="user-table">
        <thead>
            <tr>
                <th>User ID</th>
                <th>Name</th>
                <th>Role</th>
                <th>Status</th>
                <th>Action</th>
            </tr>
        </thead>
<tbody>
    {% for user in users %}
    <tr>
        <form action="{{ url_for('update_user_role') }}" method="POST">
            <input type="hidden" name="userid" value="{{ user.UserID }}">
            
            <td><strong>{{ user.UserID }}</strong></td>
            
            <td>
                <input type="text" name="new_name" value="{{ user.Name }}" style="padding: 5px; border: 1px solid #ddd; border-radius: 4px;">
            </td>
            
            <td>
                <select name="new_role" style="padding: 5px; border-radius: 4px;">
                    <option value="Student" {% if user.Role == 'Student' %}selected{% endif %}>Student</option>
                    <option value="Staff" {% if user.Role == 'Staff' %}selected{% endif %}>Staff</option>
                    <option value="Security staff" {% if user.Role == 'Security staff' %}selected{% endif %}>Security staff</option>
                    <option value="Admin" {% if user.Role == 'Admin' %}selected{% endif %}>Admin</option>
                </select>
            </td>
            
            <td>
                <select name="new_status" style="padding: 5px; border-radius: 4px;">
                    <option value="Active" {% if user.AccountStatus == 'Active' %}selected{% endif %}>Active</option>
                    <option value="Inactive" {% if user.AccountStatus == 'Inactive' %}selected{% endif %}>Inactive</option>
                </select>
            </td>
            
            <td>
                <button type="submit" class="update-btn">Save Changes</button>
            </td>
        </form>
    </tr>
    {% endfor %}
</tbody>
    </table>
</div>
{% endblock %} {# <--- ENSURE THIS TAG IS HERE #}