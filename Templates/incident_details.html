{% extends "base.html" %}
{% block title %}Incident Details{% endblock %}
{% block body %}

<main>
    <section>
        <h2>Detailed Incident Report</h2>
        <p>Review the full information regarding this campus incident.</p>
    </section>

    <section class="info">
        <div class="info-box">
            <div class="details-header">
                <h3>Report #{{ incident.IncidentID }}</h3>
                
                {% if incident.Status == 'On-going' %}
                    <span class="status-badge status-ongoing">● On-going</span>
                {% elif incident.Status == 'Completed' %}
                    <span class="status-badge status-completed">✓ Completed</span>
                {% else %}
                    <span class="status-badge">{{ incident.Status }}</span>
                {% endif %}
            </div>

            <div class="details-content">
                <div class="detail-row">
                    <p><strong>Title:</strong> {{ incident.Title }}</p>
                </div>
                
                <div class="detail-row">
                    <p><strong>Location:</strong> {{ incident.Location or 'Not Specified' }}</p>
                </div>
                
                <div class="detail-row">
                    <p><strong>Date Reported:</strong> 
                        {% if incident.DateReported.strftime is defined %}
                            {{ incident.DateReported.strftime('%d %b %Y, %H:%M') }}
                        {% else %}
                            {{ incident.DateReported }}
                        {% endif %}
                    </p>
                </div>

                <p><strong>Description:</strong></p>
                <div class="description-box">
                    {{ incident.Description }}
                </div>
            </div>

            {% if session.get('role') == 'Security staff' or session.get('role') == 'Admin' %}
            <div class="detail-row">
                <form action="{{ url_for('update_incident_status', incident_id=incident.IncidentID) }}" method="POST">
                    <label><strong>Update Status:</strong></label>
                    <select name="status" style="padding: 5px; border-radius: 5px;">
                        <option value="On-going" {% if incident.Status == 'On-going' %}selected{% endif %}>On-going</option>
                        <option value="Completed" {% if incident.Status == 'Completed' %}selected{% endif %}>Completed</option>
                        <option value="Pending Review" {% if incident.Status == 'Pending Review' %}selected{% endif %}>Pending Review</option>
                    </select>
                    <button type="submit" style="padding: 5px 15px; margin-left: 10px;">Update</button>
                </form>
            </div>
            {% endif %}

            {% if session.get('role') == 'Admin' %}
                <a href="{{ url_for('admin_dashboard') }}">← Back to Dashboard</a>
            {% else %}
                <a href="{{ url_for('home') }}">← Back to Dashboard</a>
            {% endif %}
        </div>
    </section>
</main>

{% endblock %}